statement ok
DROP DATABASE IF EXISTS db1

statement ok
CREATE DATABASE db1

statement ok
USE db1

statement ok
create table t(a int) cluster by(a) change_tracking = false

statement ok
insert into t values(1),(2)

statement error 1065
select a, _origin_version is null, _origin_block_id is null, _origin_block_row_num, _row_version from t order by a

statement ok
alter table t set options(change_tracking = true)

statement ok
insert into t values(3),(4)

query IBBII
select a, _origin_version is null, _origin_block_id is null, _origin_block_row_num, _row_version from t order by a
----
1 1 1 NULL 0
2 1 1 NULL 0
3 1 1 NULL 0
4 1 1 NULL 0

statement ok
delete from t where a = 3

query IBBII
select a, _origin_version is null, _origin_block_id is null, _origin_block_row_num, _row_version from t order by a
----
1 1 1 NULL 0
2 1 1 NULL 0
4 0 0 1 0

statement ok
update t set a=3 where _origin_version is not null

statement ok
optimize table t compact

query IBBII
select a, _origin_version is null, _origin_block_id is null, _origin_block_row_num, _row_version from t order by a
----
1 0 0 0 0
2 0 0 1 0
3 0 0 1 1

statement ok
insert into t values(5),(6)

statement ok
alter table t recluster

query IBBII
select a, _origin_version is null, _origin_block_id is null, _origin_block_row_num, _row_version from t order by a
----
1 0 0 0 0
2 0 0 1 0
3 0 0 1 1
5 0 0 0 0
6 0 0 1 0

statement error 1065
select change$is_update from t

statement ok
replace into t on(a) values(6),(7)

query IBBII
select a, _origin_version is null, _origin_block_id is null, _origin_block_row_num, _row_version from t order by a
----
1 0 0 0 0
2 0 0 1 0
3 0 0 1 1
5 0 0 0 0
6 0 0 0 0
7 0 0 1 0

statement ok
create table t2(a int)

statement ok
insert into t2 values(1)

statement error 1002
merge into t using t2 on t.a = t2.a when matched then delete

statement ok
drop table t all

statement ok
drop table t2 all

statement ok
drop database db1
